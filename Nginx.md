# Nginx

## Nginx是什么?

- 一个高性能的HTTP和反向代理web服务器

- 一款轻量级的Web服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器 

- BSD-like协议下发行

- 特点是占有内存少，并发能力强

- |  Web服务器   | Nginx  | Apache | Lighttpd |
  | :----------: | :----: | :----: | :------: |
  |   反向代理   | 非常好 |   好   |   一般   |
  | Rewrite规则  | 非常好 |   好   |   一般   |
  |   FastCGI    |   好   |   差   |  非常好  |
  |    热部署    |  支持  | 不支持 |  不支持  |
  | 系统压力比较 |  很小  |   小   |   很大   |
  |    稳定性    | 非常好 |   好   |   一般   |
  |    安全性    |  一般  |   好   |   一般   |
  |   技术资料   |  很少  | 非常多 |   一般   |
  | 静态文件处理 | 非常好 |  一般  |    好    |
  |   虚拟主机   |  支持  |  支持  |   支持   |
  |   内存消耗   | 非常小 |  很大  |  非常小  |

  

## 为什么用Nginx？

- 在互联网项目下，因单个tomcat默认并发量有限制。如果请求量过大，会产生如下问题：

  ```
  Tomcat8 默认配置的最大请求数是 150，也就是说同时支持 150 个并发，当然了，也可以将其改大。
  当某个应用拥有 250 个以上并发的时候，应考虑应用服务器的集群。
  具体能承载多少并发，需要看硬件的配置，CPU 越多性能越高，分配给 JVM 的内存越多性能也就越高，但也会加重 GC 的负担。
  操作系统对于进程中的线程数有一定的限制：
  Windows 每个进程中的线程数不允许超过 2000
  Linux 每个进程中的线程数不允许超过 1000
  (在 Java 中每开启一个线程需要耗用 1MB 的 JVM 内存空间用于作为线程栈之用。)
  
  Tomcat的最大并发数是可以配置的，实际运用中，最大并发数与硬件性能和CPU数量都有很大关系的。更好的硬件，更多的处理器都会使Tomcat支持更多的并发。
  maxThreads="150" 最大并发数 
  minSpareThreads="10"///初始化时创建的线程数
  maxSpareThreads="500"///一旦创建的线程超过这个值，Tomcat就会关闭不再需要的socket线程。
  ```

### 高并发

- 是互联网分布式系统架构设计中必须考虑的因素之一
- 指通过设计保证系统能够同时并行处理很多请求
- 高并发相关常用的一些指标有响应时间（Response Time），吞吐量（Throughput），每秒查询率QPS（Query Per Second），并发用户数等
  - 响应时间
    - 系统对请求做出响应的时间
    - 例如系统处理一个HTTP请求需要200ms，这个200ms就是系统的响应时间
  - 吞吐量
    - 单位时间内处理的请求数量
  - QPS
    - 每秒响应请求数
    - 在互联网领域，这个指标和吞吐量区分的没有这么明显
  - 并发用户数
    - 同时承载正常使用系统功能的用户数量

### 高可用

- 通常来描述一个系统经过专门的设计，从而减少停工时间，而保持其服务的高度可用性

### 高性能

- 是指服务响应时间快，（CPU/处理器/内存）特别是在高并发下响应时间不会急剧增加



## 代理

### 反向代理

- 指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器

### 正向代理

- 为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端

### 反向代理与正向代理的区别

- 正向代理

  - 在客户端
  - 比如需要访问某些国外网站，我们可能需要购买vpn
  - 并且vpn是在我们的用户浏览器端设置的(并不是在远端的服务器设置)
  - 浏览器先访问vpn地址，vpn地址转发请求，并最后将请求结果原路返回来

- 反向代理

  - 作用在服务器端的，是一个虚拟ip(VIP)
  - 对于用户的一个请求，会转发到多个后端处理器中的一台来处理该具体请求

  